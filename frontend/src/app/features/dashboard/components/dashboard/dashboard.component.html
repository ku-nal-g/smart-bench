<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">Smart Bench Dashboard</h1>
      <div class="user-info">
        <span class="welcome-text" *ngIf="currentUser">
          Welcome, {{ currentUser.username || currentUser.email }}
          <span class="user-role" *ngIf="currentUser.role">({{ currentUser.role }})</span>
        </span>
        <button class="logout-btn" (click)="logout()">Logout</button>
      </div>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-alert">
    {{ errorMessage }}
  </div>

  <div class="dashboard-content">
    <div class="row">
      <!-- LEFT PANEL - PROJECT LIST -->
      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h5>Available Projects ({{ projects.length }})</h5>
          </div>

          <div class="loading-spinner" *ngIf="isLoading && !selectedProject">
            Loading projects...
          </div>

          <div class="project-list" *ngIf="!isLoading || selectedProject">
            <button class="project-item" *ngFor="let project of projects" (click)="selectProject(project)"
              [class.active]="selectedProject?._id === project._id">

              <div class="project-info">
                <div class="project-name">{{ project.name }}</div>
                <div class="project-budget">Budget: ₹{{ project.budget | number }}</div>
                <div class="project-skills">
                  <span class="skill-tag" *ngFor="let skill of project.requiredSkills">
                    {{ skill }}
                  </span>
                </div>
              </div>
            </button>
          </div>

          <!-- Available Employees Summary -->
          <div class="card-footer" *ngIf="availableEmployees.length">
            <small class="text-muted">
              {{ availableEmployees.length }} employees available on bench
            </small>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL - MATCHING EMPLOYEES -->
      <div class="col-md-8">
        <div *ngIf="!selectedProject" class="selection-prompt">
          <div class="prompt-content">
            <h3>Select a Project</h3>
            <p>Choose a project from the list to see matching employees and their skills distribution.</p>
          </div>
        </div>

        <div *ngIf="selectedProject">
          <!-- Project Details -->
          <div class="card mb-4">
            <div class="card-header">
              <h5>{{ selectedProject.name }}</h5>
              <p class="mb-0">Required Skills: {{ selectedProject.requiredSkills.join(', ') }}</p>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoading" class="loading-spinner">
            Finding matching employees...
          </div>

          <!-- Matching Employees Table -->
          <div class="card mb-4" *ngIf="!isLoading && employees.length">
            <div class="card-header">
              <div class="header-with-stats">
                <h5>Matching Employees ({{ employees.length }})</h5>
                <div class="stats" *ngIf="canSeeDailyLoss() && getTotalDailyLoss() > 0">
                  <span class="total-loss">Total Daily Loss: ₹{{ getTotalDailyLoss() | number }}</span>
                </div>
              </div>
            </div>

            <div class="employee-table">
              <table class="table">
                <thead>
                  <tr>
                    <th>Employee</th>
                    <th>Matched Skills</th>
                    <th>Hourly Rate</th>
                    <th *ngIf="canSeeDailyLoss()">Daily Loss</th>
                    <th>AI Suggestion</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let emp of employees" class="employee-row">
                    <td>
                      <div class="employee-info">
                        <strong>{{ emp.name }}</strong>
                        <div class="all-skills">
                          <span class="skill-badge" *ngFor="let skill of emp.skills"
                            [class.matched]="emp.matchedSkills?.includes(skill)">
                            {{ skill }}
                          </span>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="matched-skills">
                        <span class="matched-skill" *ngFor="let skill of emp.matchedSkills">
                          {{ skill }}
                        </span>
                      </div>
                    </td>
                    <td>₹{{ emp.hourlyRate | number }}/hr</td>
                    <td *ngIf="canSeeDailyLoss()">
                      <span *ngIf="emp.dailyLoss !== undefined" class="daily-loss">
                        ₹{{ emp.dailyLoss | number }}
                      </span>
                      <span *ngIf="emp.dailyLoss === undefined" class="text-muted">
                        Hidden
                      </span>
                    </td>
                    <td>
                      <span *ngIf="emp.suggestion"
                            [class]="'badge ' + (emp.suggestion === 'Fully Project Ready' ? 'bg-success' : 'bg-warning text-dark')">
                        {{ emp.suggestion }}
                      </span>
                      <span class="text-muted" *ngIf="!emp.suggestion">
                        Loading...
                      </span>
                    </td>
                    <td>
                      <span class="status-badge" [class]="emp.status.toLowerCase()">
                        {{ emp.status }}
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- No Matches -->
          <div *ngIf="!isLoading && employees.length === 0" class="no-matches">
            <div class="no-matches-content">
              <h4>No Matching Employees</h4>
              <p>No employees found with at least 2 matching skills for this project.</p>
            </div>
          </div>

          <!-- Skill Distribution Chart -->
          <div class="card" *ngIf="!isLoading && employees.length && chartOptions">
            <div class="card-header">
              <h5>Skill Distribution</h5>
            </div>
            <div class="card-body">
              <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart" [labels]="chartOptions.labels"
                [colors]="chartOptions.colors" [legend]="chartOptions.legend">
              </apx-chart>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
